<!DOCTYPE html>
<html lang="fr">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
              content="width=device-width, initial-scale=1.0">
        <title>Documentation: plugins_utils/dovecot.py</title>
        <link rel="stylesheet"
              href="docs_style.css">
    </head>

    <body>
        <div class="container">

            <h1 class="main-title">Documentation: <code>plugins_utils/dovecot.py</code></h1>

            <p class="module-description">
                Ce module fournit des utilitaires pour manipuler les fichiers de configuration Dovecot.
                Il hérite de ConfigFileCommands pour réutiliser les fonctionnalités de gestion de fichiers et
                implémente un modèle cohérent "lire, modifier, écrire" pour les configurations Dovecot.
            </p>
            <p class="dependency-warning">
                Nécessite un accès aux fichiers de configuration Dovecot, généralement situés dans <code>/etc/dovecot/</code>.
            </p>

            <nav class="toc">
                <h3 class="toc-title">Accès Rapide aux Méthodes</h3>
                <ul class="toc-list">
                    <li class="toc-item"><a href="#read_config"
                           class="toc-link">read_config</a></li>
                    <li class="toc-item"><a href="#write_config"
                           class="toc-link">write_config</a></li>
                    <li class="toc-item"><a href="#get_global_setting"
                           class="toc-link">get_global_setting</a></li>
                    <li class="toc-item"><a href="#set_global_setting"
                           class="toc-link">set_global_setting</a></li>
                    <li class="toc-item"><a href="#get_mail_setting"
                           class="toc-link">get_mail_setting</a></li>
                    <li class="toc-item"><a href="#set_mail_setting"
                           class="toc-link">set_mail_setting</a></li>
                    <li class="toc-item"><a href="#get_mail_plugins"
                           class="toc-link">get_mail_plugins</a></li>
                    <li class="toc-item"><a href="#set_mail_plugins"
                           class="toc-link">set_mail_plugins</a></li>
                    <li class="toc-item"><a href="#list_namespaces"
                           class="toc-link">list_namespaces</a></li>
                    <li class="toc-item"><a href="#create_public_namespace"
                           class="toc-link">create_public_namespace</a></li>
                    <li class="toc-item"><a href="#read_acl_file"
                           class="toc-link">read_acl_file</a></li>
                    <li class="toc-item"><a href="#add_acl_entry"
                           class="toc-link">add_acl_entry</a></li>
                </ul>
            </nav>

            <h2 class="section-title">Classe Principale</h2>

            <section class="method-section">
                <h3 class="method-title"
                    id="DovecotCommands"><code>DovecotCommands(ConfigFileCommands)</code></h3>
                <p class="description">
                    Classe pour manipuler les fichiers de configuration Dovecot.
                    Hérite de <code>ConfigFileCommands</code> pour réutiliser les fonctionnalités de gestion de fichiers.
                    Permet une manipulation cohérente des configurations avec le modèle "lire, modifier, écrire".
                </p>
            </section>

            <h2 class="section-title">Méthodes de Base de Configuration</h2>

            <section class="method-section">
                <h4 class="method-title"
                    id="read_config">
                    <code>read_config(config_type: str, force_reload: bool = False) -> Optional[Dict]</code>
                </h4>
                <p class="description">Lit un fichier de configuration Dovecot et utilise un cache pour éviter de relire les fichiers inutilement.</p>
                <dl class="param-list">
                    <dt>config_type</dt>
                    <dd><span class="param-type">(str)</span>: Type de configuration ('main', 'mail', 'auth', etc.) ou chemin</dd>
                    <dt>force_reload</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, force la relecture même si déjà en cache. Défaut: False</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">Optional[Dict]</span> - Structure de configuration parsée ou None en cas d'erreur
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="write_config"><code>write_config(...) -> bool</code></h4>
                <p class="description">Écrit une structure de configuration Dovecot dans un fichier et met à jour le cache.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>write_config(
    config_type: str,
    config: Dict,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>config_type</dt>
                    <dd><span class="param-type">(str)</span>: Type de configuration ('main', 'mail', 'auth', etc.) ou chemin</dd>
                    <dt>config</dt>
                    <dd><span class="param-type">(Dict)</span>: Structure de configuration à écrire</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si l'écriture réussit, False sinon
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="get_config_path">
                    <code>get_config_path(config_type: str) -> Path</code>
                </h4>
                <p class="description">Obtient le chemin complet d'un fichier de configuration spécifique.</p>
                <dl class="param-list">
                    <dt>config_type</dt>
                    <dd><span class="param-type">(str)</span>: Type de configuration ('main', 'mail', 'auth', etc.)</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">Path</span> - Chemin complet du fichier de configuration
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="clear_cache">
                    <code>clear_cache(config_type: Optional[str] = None) -> None</code>
                </h4>
                <p class="description">Vide le cache de configurations.</p>
                <dl class="param-list">
                    <dt>config_type</dt>
                    <dd><span class="param-type">(Optional[str])</span>: Type de configuration spécifique à vider, ou None pour tout vider</dd>
                </dl>
            </section>

            <h2 class="section-title">Méthodes de Manipulation des Paramètres</h2>

            <section class="method-section">
                <h4 class="method-title"
                    id="get_global_setting">
                    <code>get_global_setting(setting_name: str, default: Any = None) -> Any</code>
                </h4>
                <p class="description">Récupère un paramètre global dans la configuration principale.</p>
                <dl class="param-list">
                    <dt>setting_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du paramètre à récupérer</dd>
                    <dt>default</dt>
                    <dd><span class="param-type">(Any)</span>: Valeur par défaut si le paramètre n'existe pas</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">Any</span> - Valeur du paramètre ou valeur par défaut
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="set_global_setting"><code>set_global_setting(...) -> bool</code></h4>
                <p class="description">Définit un paramètre global dans la configuration principale.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>set_global_setting(
    setting_name: str,
    value: Any,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>setting_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du paramètre à définir</dd>
                    <dt>value</dt>
                    <dd><span class="param-type">(Any)</span>: Nouvelle valeur du paramètre</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si la mise à jour réussit, False sinon
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="get_mail_setting">
                    <code>get_mail_setting(setting_name: str, default: Any = None) -> Any</code>
                </h4>
                <p class="description">Récupère un paramètre dans la configuration mail.</p>
                <dl class="param-list">
                    <dt>setting_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du paramètre à récupérer</dd>
                    <dt>default</dt>
                    <dd><span class="param-type">(Any)</span>: Valeur par défaut si le paramètre n'existe pas</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">Any</span> - Valeur du paramètre ou valeur par défaut
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="set_mail_setting"><code>set_mail_setting(...) -> bool</code></h4>
                <p class="description">Définit un paramètre dans la configuration mail.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>set_mail_setting(
    setting_name: str,
    value: Any,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>setting_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du paramètre à définir</dd>
                    <dt>value</dt>
                    <dd><span class="param-type">(Any)</span>: Nouvelle valeur du paramètre</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si la mise à jour réussit, False sinon
                </div>
            </section>

            <h2 class="section-title">Méthodes de Gestion des Plugins</h2>

            <section class="method-section">
                <h4 class="method-title"
                    id="get_mail_plugins">
                    <code>get_mail_plugins() -> List[str]</code>
                </h4>
                <p class="description">Récupère la liste des plugins mail activés.</p>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">List[str]</span> - Liste des plugins activés
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="set_mail_plugins"><code>set_mail_plugins(...) -> bool</code></h4>
                <p class="description">Définit la liste des plugins mail activés.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>set_mail_plugins(
    plugins: List[str],
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>plugins</dt>
                    <dd><span class="param-type">(List[str])</span>: Liste des plugins à activer</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si la mise à jour réussit, False sinon
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="add_mail_plugin"><code>add_mail_plugin(...) -> bool</code></h4>
                <p class="description">Ajoute un plugin mail s'il n'est pas déjà activé.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>add_mail_plugin(
    plugin_name: str,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>plugin_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du plugin à ajouter</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si la mise à jour réussit, False sinon
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="remove_mail_plugin"><code>remove_mail_plugin(...) -> bool</code></h4>
                <p class="description">Supprime un plugin mail s'il est activé.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>remove_mail_plugin(
    plugin_name: str,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>plugin_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du plugin à supprimer</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si la mise à jour réussit, False sinon
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="get_plugin_setting"><code>get_plugin_setting(...) -> Any</code></h4>
                <p class="description">Récupère un paramètre dans la configuration d'un plugin.</p>
                <div class="method-signature">
                    <pre><code>get_plugin_setting(
    plugin_type: str,
    setting_name: str,
    default: Any = None
) -> Any</code></pre>
                </div>
                <dl class="param-list">
                    <dt>plugin_type</dt>
                    <dd><span class="param-type">(str)</span>: Type de plugin ('quota', 'acl', 'sieve', etc.)</dd>
                    <dt>setting_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du paramètre à récupérer</dd>
                    <dt>default</dt>
                    <dd><span class="param-type">(Any)</span>: Valeur par défaut si le paramètre n'existe pas</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">Any</span> - Valeur du paramètre ou valeur par défaut
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="set_plugin_setting"><code>set_plugin_setting(...) -> bool</code></h4>
                <p class="description">Définit un paramètre dans la configuration d'un plugin.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>set_plugin_setting(
    plugin_type: str,
    setting_name: str,
    value: Any,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>plugin_type</dt>
                    <dd><span class="param-type">(str)</span>: Type de plugin ('quota', 'acl', 'sieve', etc.)</dd>
                    <dt>setting_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du paramètre à définir</dd>
                    <dt>value</dt>
                    <dd><span class="param-type">(Any)</span>: Nouvelle valeur du paramètre</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si la mise à jour réussit, False sinon
                </div>
            </section>

            <h2 class="section-title">Méthodes de Gestion des Namespaces</h2>

            <section class="method-section">
                <h4 class="method-title"
                    id="list_namespaces"><code>list_namespaces(...) -> Dict[str, Dict]</code></h4>
                <p class="description">Liste tous les namespaces dans un fichier de configuration.</p>
                <div class="method-signature">
                    <pre><code>list_namespaces(
    config_path: Optional[str] = None
) -> Dict[str, Dict]</code></pre>
                </div>
                <dl class="param-list">
                    <dt>config_path</dt>
                    <dd><span class="param-type">(Optional[str])</span>: Chemin du fichier de configuration ou None pour utiliser le fichier mail par défaut</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">Dict[str, Dict]</span> - Dictionnaire {nom_namespace: config_namespace}
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="get_namespace"><code>get_namespace(...) -> Optional[Dict]</code></h4>
                <p class="description">Récupère la configuration d'un namespace spécifique.</p>
                <div class="method-signature">
                    <pre><code>get_namespace(
    namespace_name: str,
    config_path: Optional[str] = None
) -> Optional[Dict]</code></pre>
                </div>
                <dl class="param-list">
                    <dt>namespace_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du namespace à récupérer</dd>
                    <dt>config_path</dt>
                    <dd><span class="param-type">(Optional[str])</span>: Chemin du fichier de configuration ou None pour utiliser le fichier mail par défaut</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">Optional[Dict]</span> - Configuration du namespace ou None s'il n'existe pas
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="add_namespace"><code>add_namespace(...) -> bool</code></h4>
                <p class="description">Ajoute un nouveau namespace à la configuration.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>add_namespace(
    namespace_name: str,
    namespace_config: Dict,
    config_path: Optional[str] = None,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>namespace_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du namespace à ajouter (sans le préfixe "namespace ")</dd>
                    <dt>namespace_config</dt>
                    <dd><span class="param-type">(Dict)</span>: Dictionnaire de configuration du namespace</dd>
                    <dt>config_path</dt>
                    <dd><span class="param-type">(Optional[str])</span>: Chemin du fichier de configuration ou None pour utiliser le fichier mail par défaut</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si l'ajout réussit, False sinon
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="update_namespace"><code>update_namespace(...) -> bool</code></h4>
                <p class="description">Met à jour un namespace existant.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>update_namespace(
    namespace_name: str,
    updated_config: Dict,
    config_path: Optional[str] = None,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>namespace_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du namespace à mettre à jour (sans le préfixe "namespace ")</dd>
                    <dt>updated_config</dt>
                    <dd><span class="param-type">(Dict)</span>: Dictionnaire de configuration mis à jour</dd>
                    <dt>config_path</dt>
                    <dd><span class="param-type">(Optional[str])</span>: Chemin du fichier de configuration ou None pour utiliser le fichier mail par défaut</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si la mise à jour réussit, False sinon
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="delete_namespace"><code>delete_namespace(...) -> bool</code></h4>
                <p class="description">Supprime un namespace existant.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>delete_namespace(
    namespace_name: str,
    config_path: Optional[str] = None,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>namespace_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du namespace à supprimer (sans le préfixe "namespace ")</dd>
                    <dt>config_path</dt>
                    <dd><span class="param-type">(Optional[str])</span>: Chemin du fichier de configuration ou None pour utiliser le fichier mail par défaut</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si la suppression réussit, False sinon
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="comment_namespace"><code>comment_namespace(...) -> bool</code></h4>
                <p class="description">Commente un namespace existant. Cette méthode manipule directement le contenu du fichier plutôt que la structure parsée.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>comment_namespace(
    namespace_name: str,
    config_path: Optional[str] = None,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>namespace_name</dt>
                    <dd><span class="param-type">(str)</span>: Nom du namespace à commenter (ex: "PUBLIC_FINANCE")</dd>
                    <dt>config_path</dt>
                    <dd><span class="param-type">(Optional[str])</span>: Chemin du fichier de configuration ou None pour utiliser le fichier mail par défaut</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si le commentage réussit, False sinon
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="uncomment_namespace"><code>uncomment_namespace(...) -> bool</code></h4>
                <p class="description">Décommente un namespace commenté. Cette méthode manipule directement le contenu du fichier plutôt que la structure parsée.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>uncomment_namespace(
    namespace_pattern: str,
    config_path: Optional[str] = None,
    backup: bool = True
) -> bool</code></pre>
                </div>
                <dl class="param-list">
                    <dt>namespace_pattern</dt>
                    <dd><span class="param-type">(str)</span>: Motif pour identifier le namespace (ex: "PUBLIC_FINANCE")</dd>
                    <dt>config_path</dt>
                    <dd><span class="param-type">(Optional[str])</span>: Chemin du fichier de configuration ou None pour utiliser le fichier mail par défaut</dd>
                    <dt>backup</dt>
                    <dd><span class="param-type">(bool)</span>: Si True, crée une sauvegarde du fichier original. Défaut: True</dd>
                </dl>
                <div class="return-info">
                    <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si le décommentage réussit, False sinon
                </div>
            </section>

            <section class="method-section">
                <h4 class="method-title"
                    id="create_public_namespace"><code>create_public_namespace(...) -> bool</code></h4>
                <p class="description">Crée un namespace public pour une unité spécifique.</p>
                <p class="sudo-warning">Nécessite des privilèges root pour écrire dans les fichiers de configuration.</p>
                <div class="method-signature">
                    <pre><code>create_public_namespace(
    unite: str,
    location: Optional[str] = None,
    config_path: Optional[str] = None,
    backup: bool = True
) -> bool</code>