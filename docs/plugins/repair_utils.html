<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documentation: plugins_utils/repair_utils.py</title>
  <link rel="stylesheet" href="docs_style.css">
  <style>
    /* Style additionnel pour les avertissements forts */
    .destructive-warning {
      color: #dc3545;
      /* Rouge vif */
      background-color: #f8d7da;
      border: 1px solid #f1aeb5;
      font-weight: 700;
      /* Gras */
      padding: 0.75rem;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      border-radius: 4px;
    }

    .destructive-warning::before {
      content: "üö® ATTENTION: ";
    }

    /* Style additionnel pour les avertissements de d√©pendance */
    .dependency-warning {
      color: #856404;
      /* Jaune/brun */
      background-color: #fff3cd;
      /* Jaune clair */
      border: 1px solid #ffeeba;
      /* Jaune moyen */
      border-radius: 4px;
      padding: 0.75rem 1rem;
      font-size: 0.9rem;
      font-weight: 500;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
    }

    .dependency-warning::before {
      content: "‚ö†Ô∏è Pr√©requis: ";
    }
  </style>
</head>

<body>
  <div class="container">

    <h1 class="main-title">Documentation: <code>plugins_utils/repair_utils.py</code></h1>

    <p class="module-description">
      Ce module fournit des utilitaires pour effectuer des actions de r√©paration syst√®me courantes.
      Il combine des fonctionnalit√©s d'autres modules utilitaires comme <code>AptCommands</code>,
      <code>DpkgCommands</code>, <code>LogCommands</code>, et <code>ServiceCommands</code>.
    </p>
    <p class="dependency-warning">
      N√©cessite que les modules utilitaires sous-jacents (Apt, Dpkg, Log, Services, Network)
      soient disponibles et fonctionnels. La plupart des op√©rations n√©cessitent des privil√®ges root.
    </p>

    <nav class="toc">
      <h3 class="toc-title">Acc√®s Rapide aux M√©thodes</h3>
      <ul class="toc-list">
        <li class="toc-item"><a href="#apt_fix_broken_install" class="toc-link">apt_fix_broken_install</a></li>
        <li class="toc-item"><a href="#dpkg_configure_pending" class="toc-link">dpkg_configure_pending</a></li>
        <li class="toc-item"><a href="#force_log_rotation" class="toc-link">force_log_rotation</a></li>
        <li class="toc-item"><a href="#clear_temp_files" class="toc-link">clear_temp_files</a></li>
        <li class="toc-item"><a href="#restart_networking" class="toc-link">restart_networking</a></li>
        <li class="toc-item"><a href="#restart_dns_resolver" class="toc-link">restart_dns_resolver</a></li>
      </ul>
    </nav>

    <h2 class="section-title">Classe Principale</h2>

    <section class="method-section">
      <h3 class="method-title" id="RepairCommands"><code>RepairCommands(PluginUtilsBase)</code></h3>
      <p class="description">
        Classe pour ex√©cuter des actions de r√©paration syst√®me courantes.
        H√©rite de <code>PluginUtilsBase</code> et utilise d'autres commandes utilitaires.
      </p>
    </section>

    <h2 class="section-title">M√©thodes Principales</h2>

    <section class="method-section">
      <h4 class="method-title" id="apt_fix_broken_install"><code>apt_fix_broken_install() -> bool</code></h4>
      <p class="description">Tente de r√©parer les d√©pendances APT cass√©es via <code>AptCommands.fix_broken()</code>
        (√©quivalent √† <code>apt --fix-broken install</code>).</p>
      <p class="dependency-warning">N√©cessite le module <code>AptCommands</code>.</p>
      <p class="sudo-warning">N√©cessite des privil√®ges root.</p>
      <div class="return-info">
        <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si la r√©paration a r√©ussi
        ou si rien n'√©tait cass√©.
      </div>
    </section>

    <section class="method-section">
      <h4 class="method-title" id="dpkg_configure_pending"><code>dpkg_configure_pending() -> bool</code></h4>
      <p class="description">Tente de configurer tous les paquets d√©compress√©s mais non configur√©s via
        <code>dpkg --configure -a</code>.</p>
      <p class="sudo-warning">N√©cessite des privil√®ges root.</p>
      <div class="return-info">
        <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si la commande s'est
        ex√©cut√©e avec succ√®s.
      </div>
    </section>

    <section class="method-section">
      <h4 class="method-title" id="force_log_rotation">
        <code>force_log_rotation(config_file: Optional[str] = None) -> bool</code></h4>
      <p class="description">Force l'ex√©cution de logrotate via <code>LogCommands.force_logrotate()</code>.</p>
      <p class="dependency-warning">N√©cessite le module <code>LogCommands</code>.</p>
      <p class="sudo-warning">N√©cessite des privil√®ges root.</p>
      <dl class="param-list">
        <dt>config_file</dt>
        <dd><span class="param-type">(Optional[str])</span>: Chemin optionnel vers un fichier de configuration logrotate
          sp√©cifique. Si None, utilise la configuration syst√®me globale.</dd>
      </dl>
      <div class="return-info">
        <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si succ√®s.
      </div>
    </section>

    <section class="method-section">
      <h4 class="method-title" id="clear_temp_files"><code>clear_temp_files(...) -> bool</code></h4>
      <p class="description">Nettoie les fichiers temporaires dans des r√©pertoires sp√©cifi√©s via
        <code>find ... -delete</code>.</p>
      <p class="destructive-warning">Utiliser avec prudence. Par d√©faut en mode simulation (<code>dry_run=True</code>).
      </p>
      <p class="sudo-warning">N√©cessite des privil√®ges root.</p>
      <div class="method-signature">
        <pre><code>clear_temp_files(
    directories: Optional[List[str]] = None,
    older_than_days: int = 7,
    patterns: Optional[List[str]] = None,
    dry_run: bool = True
) -> bool</code></pre>
      </div>
      <dl class="param-list">
        <dt>directories</dt>
        <dd><span class="param-type">(Optional[List[str]])</span>: Liste de r√©pertoires √† nettoyer. D√©faut: ['/tmp',
          '/var/tmp'].</dd>
        <dt>older_than_days</dt>
        <dd><span class="param-type">(int)</span>: Supprimer les fichiers plus vieux que N jours (mtime). D√©faut: 7.
        </dd>
        <dt>patterns</dt>
        <dd><span class="param-type">(Optional[List[str]])</span>: Liste de motifs de noms de fichiers √† cibler (ex:
          ['*.tmp', 'sess_*']). Si None, cible tous les fichiers ('*').</dd>
        <dt>dry_run</dt>
        <dd><span class="param-type">(bool)</span>: Si True (d√©faut), simule seulement la suppression (affiche les
          fichiers). Si False, supprime r√©ellement.</dd>
      </dl>
      <div class="return-info">
        <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si l'op√©ration (ou la
        simulation) a r√©ussi.
      </div>
    </section>

    <section class="method-section">
      <h4 class="method-title" id="restart_networking">
        <code>restart_networking(force_network_manager: bool = False) -> bool</code></h4>
      <p class="description">Tente de red√©marrer le service r√©seau principal (NetworkManager, systemd-networkd, ou
        networking) via <code>ServiceCommands</code>.</p>
      <p class="destructive-warning">Peut couper la connexion SSH si ex√©cut√© √† distance !</p>
      <p class="dependency-warning">N√©cessite les modules <code>ServiceCommands</code> et <code>NetworkCommands</code>.
      </p>
      <p class="sudo-warning">N√©cessite des privil√®ges root.</p>
      <dl class="param-list">
        <dt>force_network_manager</dt>
        <dd><span class="param-type">(bool)</span>: Si True, tente de red√©marrer NetworkManager m√™me s'il n'est pas
          d√©tect√© comme gestionnaire principal. D√©faut: False.</dd>
      </dl>
      <div class="return-info">
        <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si un service r√©seau a
        √©t√© red√©marr√© avec succ√®s.
      </div>
    </section>

    <section class="method-section">
      <h4 class="method-title" id="restart_dns_resolver"><code>restart_dns_resolver() -> bool</code></h4>
      <p class="description">Tente de red√©marrer le service de r√©solution DNS local (typiquement
        <code>systemd-resolved</code>) via <code>ServiceCommands</code>.</p>
      <p class="dependency-warning">N√©cessite le module <code>ServiceCommands</code>.</p>
      <p class="sudo-warning">N√©cessite des privil√®ges root.</p>
      <div class="return-info">
        <span class="font-medium">Retourne:</span><span class="return-type">bool</span> - True si un service de
        r√©solution a √©t√© red√©marr√© avec succ√®s.
      </div>
    </section>

  </div>
</body>

</html>